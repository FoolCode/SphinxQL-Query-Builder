language: php

sudo: false

php:
  - 5.6
  - 7.0
  - 7.1

env:
  - DRIVER=mysqli SEARCH_BUILD=SPHINX2
  - DRIVER=mysqli SEARCH_BUILD=SPHINX3
  - DRIVER=mysqli SEARCH_BUILD=MANTICORE
  - DRIVER=pdo SEARCH_BUILD=SPHINX2
  - DRIVER=pdo SEARCH_BUILD=SPHINX3
  - DRIVER=pdo SEARCH_BUILD=MANTICORE

matrix:
  fast_finish: true

before_install:
  - mkdir $HOME/search
  - pushd $HOME/search
  - $HOME/tests/install.sh
  - popd

before_script:
  - composer dump-autoload
  - cd tests
  - gcc -shared -o data/test_udf.so test_udf.c
  - $HOME/tests/run.sh

script: phpunit --configuration travis/$DRIVER.phpunit.xml --coverage-text
